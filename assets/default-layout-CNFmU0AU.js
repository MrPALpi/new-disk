import{d as y,p as J,s as f,q as W,o as d,i as w,w as v,a as i,e as m,k as M,_ as I,r as U,c as x,v as T,x as K,j as G,y as Q,F as X,z as A,A as j,t as F,u as e,l as R,B as Z,C as P,b as z}from"./index-BW6Pwd1S.js";import{V as O}from"./v-icon-gCxBPUp0.js";import{a as H,V as Y,b as D,d as ee}from"./v-form-Bg95FnS6.js";const oe="eye",te="eye-close",se=y({__name:"v-password",props:{model:{},modelModifiers:{}},emits:["update:model"],setup(u){const s=J(u,"model"),t=f(!1),l=W(()=>t.value?"text":"password");return(o,a)=>(d(),w(H,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=c=>s.value=c),type:l.value,placeholder:"Введите пароль"},{right:v(()=>[i("span",{onClick:a[0]||(a[0]=c=>t.value=!t.value)},[m(M,{name:"icon",mode:"out-in"},{default:v(()=>[t.value?(d(),w(O,{key:0,name:te,class:"input-label__icon"})):(d(),w(O,{key:1,name:oe,class:"input-label__icon"}))]),_:1})])]),default:v(()=>[a[2]||(a[2]=i("input",{type:"password"},null,-1))]),_:1},8,["modelValue","type"]))}}),N=I(se,[["__scopeId","data-v-83ce333e"]]),ae=y({__name:"v-popover",props:{closeClickContent:{type:Boolean}},setup(u){const s=u,t=U(!1),l=U(null),o=U(null),a=W(()=>{if(!l.value||!o.value)return{};const{top:r,left:V,width:g}=l.value.getBoundingClientRect(),E=o.value.offsetWidth;return{top:`${r+window.scrollY+70}px`,left:`${V+g-E+window.scrollX}px`}}),c=()=>{t.value=!t.value},n=r=>{const V=Object.is(r.relatedTarget,l.value),g=!r.relatedTarget;(s.closeClickContent||g||V)&&(t.value=!1)};return(r,V)=>(d(),x(X,null,[i("div",{ref_key:"trigger",ref:l,onClick:c,onBlur:n,class:"popover-trigger",tabindex:"-1"},[T(r.$slots,"trigger",{},void 0,!0)],544),(d(),w(Q,{to:"body"},[m(M,{name:"popover"},{default:v(()=>[t.value?(d(),x("div",{key:0,ref_key:"popover",ref:o,style:K(a.value),onBlur:n,class:"popover",tabindex:"-1"},[T(r.$slots,"content",{},void 0,!0)],36)):G("",!0)]),_:3})]))],64))}}),le=I(ae,[["__scopeId","data-v-973e9ea7"]]),ne={class:"user-info"},re={class:"user-info__name text-small"},ue=y({__name:"user-info",setup(u){const s=A(),t=j(),l=()=>{s.logout().then(()=>{t.push({name:"home"})})};return(o,a)=>(d(),w(e(le),{closeClickContent:!0},{trigger:v(()=>[i("div",ne,[i("span",re,F(e(s).email),1),m(e(O),{name:"user",class:"user-info__icon"})])]),content:v(()=>[i("a",{class:"exit",href:"#",onClick:R(l,["prevent"])},"Выйти")]),_:1}))}}),ie=I(ue,[["__scopeId","data-v-cb6791af"]]),de={class:"nav-bar container"},me={class:"nav-bar__right"},ce=y({__name:"nav-bar",setup(u){return(s,t)=>{const l=Z("router-link");return d(),x("div",de,[m(l,{to:"/",class:"nav-bar__home-link"},{default:v(()=>[m(e(O),{name:"logo",class:"nav-bar__logo"})]),_:1}),i("div",me,[T(s.$slots,"right",{},void 0,!0)])])}}}),pe=I(ce,[["__scopeId","data-v-7e34c1bf"]]),ve="Поле не может быть пустым",_e="Некорректная почта",fe=/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu,L=()=>{const u=f(""),s=f("");return{email:u,validateEmail:()=>{if(!u.value.length)return s.value=ve,!1;const o=fe.test(u.value);return s.value=o?"":_e,o},errorEmail:s}},q=(u=0,s=1/0)=>{const t=`Поле не может быть больше ${s} символов`,l=`Поле не может быть меньше ${u} символов`,o="Поле не может быть пустым",a=f(""),c=f("");return{password:a,validatePassword:()=>{const r=a.value.length;return r===0?(c.value=o,!1):r<u?(c.value=l,!1):r>s?(c.value=t,!1):(c.value="",!0)},errorPassword:c}},ge="Поле не может быть пустым",we="Пароли не совпадают",Ee=u=>{const s=f(""),t=f("");return{confirmPassword:s,validateConfirmPassword:()=>{const o=s.value.length,a=!!o&&u.value===s.value;return t.value=a?"":o?we:ge,a},errorConfirmPassword:t}},Ce={class:"form__inputs"},Ve={class:"form__bottom"},ye={class:"form__bottom-text text-small"},be={key:0,class:"form__error text-small"},$e=y({__name:"login-form",emits:["to-sign-up","next-page"],setup(u,{emit:s}){const t=A(),l=s,{email:o,validateEmail:a,errorEmail:c}=L(),{password:n,validatePassword:r,errorPassword:V}=q(4,12),g=f(!1),E=f(""),B=()=>a()&&r(),S=(C="")=>{E.value=C,setTimeout(()=>{E.value=""},5e3)},$=async()=>{if(B()){g.value=!0;try{const C=await t.login(o.value,n.value);if(C.status)return l("next-page");S(C.message)}catch(C){console.error(C)}finally{g.value=!1}}};return(C,_)=>(d(),w(e(D),{onSubmit:R($,["prevent"]),loading:g.value,class:"login-form form"},{default:v(()=>[_[4]||(_[4]=i("h2",{class:"title-h2"},"Вход в ваш аккаунт",-1)),i("div",Ce,[m(e(H),{modelValue:e(o),"onUpdate:modelValue":_[0]||(_[0]=h=>P(o)?o.value=h:null),onChange:e(a),error:e(c),name:"email",label:"Email",placeholder:"Введите email",type:"email"},null,8,["modelValue","onChange","error"]),m(e(N),{modelValue:e(n),"onUpdate:modelValue":_[1]||(_[1]=h=>P(n)?n.value=h:null),onChange:e(r),error:e(V),name:"password",label:"Пароль",placeholder:"Введите пароль"},null,8,["modelValue","onChange","error"])]),i("div",Ve,[i("span",ye,[_[3]||(_[3]=z("У вас нет аккаунта? ")),i("a",{href:"#",onClick:_[2]||(_[2]=R(h=>l("to-sign-up"),["prevent"]))},"Зарегистрируйтесь")]),m(e(Y),{label:"Войти",type:"submit",class:"form__submit"}),m(M,{name:"form-error"},{default:v(()=>[E.value?(d(),x("div",be,F(E.value),1)):G("",!0)]),_:1})])]),_:1},8,["loading"]))}}),he={class:"form__inputs"},ke={class:"form__bottom"},xe={class:"form__bottom-text text-small"},Se={key:0,class:"form__error text-small"},Pe=y({__name:"sign-up-form",emits:["to-login","next-page"],setup(u,{emit:s}){const t=A(),l=s,{email:o,validateEmail:a,errorEmail:c}=L(),{password:n,validatePassword:r,errorPassword:V}=q(4,12),{confirmPassword:g,validateConfirmPassword:E,errorConfirmPassword:B}=Ee(n),S=f(!1),$=f(""),C=()=>a()&&r()&&E(),_=(b="")=>{$.value=b,setTimeout(()=>{$.value=""},5e3)},h=async()=>{if(C()){S.value=!0;try{const b=await t.signUp(o.value,n.value,g.value);if(b.status){const p=await t.login(o.value,n.value);if(p.status)return l("next-page");_(p.message)}_(b.message)}catch(b){console.error(b)}finally{S.value=!1}}};return(b,p)=>(d(),w(e(D),{onSubmit:R(h,["prevent"]),loading:S.value,class:"login-form form"},{default:v(()=>[p[5]||(p[5]=i("h2",{class:"title-h2"},"Регистрация",-1)),i("div",he,[m(e(H),{modelValue:e(o),"onUpdate:modelValue":p[0]||(p[0]=k=>P(o)?o.value=k:null),onChange:e(a),error:e(c),name:"email",label:"Email",placeholder:"Введите email",type:"email"},null,8,["modelValue","onChange","error"]),m(e(N),{modelValue:e(n),"onUpdate:modelValue":p[1]||(p[1]=k=>P(n)?n.value=k:null),onChange:e(r),error:e(V),name:"password",label:"Пароль",placeholder:"Введите пароль"},null,8,["modelValue","onChange","error"]),m(e(N),{modelValue:e(g),"onUpdate:modelValue":p[2]||(p[2]=k=>P(g)?g.value=k:null),onChange:e(E),error:e(B),name:"confirm_password",label:"Пароль ещё раз",placeholder:"Введите пароль ещё раз"},null,8,["modelValue","onChange","error"])]),i("div",ke,[i("span",xe,[p[4]||(p[4]=z("У вас есть аккаунт? ")),i("a",{href:"#",onClick:p[3]||(p[3]=R(k=>l("to-login"),["prevent"]))},"Войдите")]),m(e(Y),{label:"Зарегестрироваться",type:"submit",class:"form__submit"}),m(M,{name:"form-error"},{default:v(()=>[$.value?(d(),x("div",Se,F($.value),1)):G("",!0)]),_:1})])]),_:1},8,["loading"]))}}),Re=y({__name:"entry-form",emits:["close"],setup(u,{emit:s}){const t=s,l=j(),o=f(!0),a=()=>{t("close"),l.push({name:"note"})};return(c,n)=>(d(),w(M,{name:"form",mode:"out-in"},{default:v(()=>[o.value?(d(),w(e($e),{key:0,onToSignUp:n[0]||(n[0]=r=>o.value=!1),onNextPage:a})):(d(),w(e(Pe),{key:1,onToLogin:n[1]||(n[1]=r=>o.value=!0),onNextPage:a}))]),_:1}))}}),Me=I(Re,[["__scopeId","data-v-08c2353f"]]),Ie={class:"container"},Be=y({__name:"default-layout",setup(u){const s=A(),t=f(!1);return(l,o)=>(d(),x(X,null,[m(e(pe),null,{right:v(()=>[e(s).isAuth?(d(),w(e(ie),{key:0})):(d(),w(e(Y),{key:1,label:"Войти",icon:"login",onClick:o[0]||(o[0]=a=>t.value=!0)}))]),_:1}),i("main",Ie,[T(l.$slots,"default")]),m(e(ee),{modelValue:t.value,"onUpdate:modelValue":o[2]||(o[2]=a=>t.value=a)},{default:v(()=>[m(e(Me),{onClose:o[1]||(o[1]=a=>t.value=!1)})]),_:1},8,["modelValue"])],64))}});export{Be as default};
