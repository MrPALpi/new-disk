import{d as y,m as B,f as T,w as W,o as d,c as m,t as f,g as b,a as p,h as C,v as L,i as x,e as u,j as g,T as M,_ as w,k as $,l as U,r as A,s as h,u as r,F as D,n as E,p as F,q as I,x as P,y as j}from"./index-DDjnyTJG.js";import{V as k,a as q,b as z,c as G,d as R}from"./v-form-CyRFnmWp.js";import"./v-icon-BrRGhcQu.js";const H={class:"input-label"},J={key:0,class:"input-label__text text-small"},K={class:"input-label__box input-label__box_area"},O={class:"input-label__bottom text-small"},Q={key:0,class:"input-label__error"},X={key:0,class:"input-label__bottom-limit"},Y=y({__name:"v-textarea",props:B({label:{},limit:{},error:{}},{model:{},modelModifiers:{}}),emits:["update:model"],setup(o){const e=T(o,"model"),i=o;return W(()=>{!e.value||!i.limit||e.value.length>i.limit&&(e.value=e.value.slice(0,i.limit))}),(l,t)=>{var s;return d(),m("label",H,[(s=l.label)!=null&&s.length?(d(),m("span",J,f(l.label),1)):b("",!0),p("span",K,[C(p("textarea",x({"onUpdate:modelValue":t[0]||(t[0]=a=>e.value=a)},l.$attrs,{class:"input-label__area input"}),null,16),[[L,e.value]])]),p("span",O,[u(M,{name:"error"},{default:g(()=>[l.error?(d(),m("span",Q,f(l.error),1)):b("",!0)]),_:1}),l.limit?(d(),m("span",X,f(typeof e.value=="string"?e.value.length:e.value||0)+" / "+f(l.limit),1)):b("",!0)])])}}}),Z=w(Y,[["__scopeId","data-v-3c159db5"]]),S={async fetch(){const o=await $.get("/api/notes");return o==null?void 0:o.data},async add(o){const e=await $.post("/api/notes",o);return e==null?void 0:e.data},async delete(o){const e=await $.delete(`/api/notes/${o}`);return e==null?void 0:e.data}},N=U("note",()=>{const o=A([]),e=h(!1);return{notes:o,fetch:async()=>{var s;e.value=!0;try{const a=await S.fetch();if(Array.isArray(a))return o.value=a,{status:!0};throw a}catch(a){const{statusCode:n,message:c}=a;return{status:!1,message:(s=n==null?void 0:n.toString())!=null&&s.startsWith("4")?c:"Something went wrong"}}finally{e.value=!1}},add:async s=>{var a;e.value=!0;try{const n=await S.add(s);if("title"in n&&"content"in n)return o.value.push(n),{status:!0};throw n}catch(n){const{statusCode:c,message:_}=n;return{status:!1,message:(a=c==null?void 0:c.toString())!=null&&a.startsWith("4")?_:"Something went wrong"}}finally{e.value=!1}},deleteNote:async s=>{var a;e.value=!0;try{return await S.delete(s),o.value=o.value.filter(n=>n.id!==s),{status:!0}}catch(n){const{statusCode:c,message:_}=n;return{status:!1,message:(a=c==null?void 0:c.toString())!=null&&a.startsWith("4")?_:"Something went wrong"}}finally{e.value=!1}},loading:e}}),ee={class:"note"},te={class:"note__header"},se={class:"note__title title-h4"},ae={class:"note__content"},oe={class:"note__footer"},le=y({__name:"note-item",props:{id:{},title:{},content:{}},emits:["delete"],setup(o,{emit:e}){const i=e;return(l,t)=>(d(),m("div",ee,[p("div",te,[p("h3",se,f(l.title),1)]),p("div",ae,f(l.content),1),p("div",oe,[u(r(k),{onClick:t[0]||(t[0]=s=>i("delete",l.id)),label:"Удалить",icon:"close",class:"note__delete"})])]))}}),ne=w(le,[["__scopeId","data-v-6e1fe1bd"]]),re={key:0,class:"note-list"},ie={key:1,class:"note-list-empty title-h1"},ue=y({__name:"note-list",setup(o){const e=N(),i=async t=>e.deleteNote(t),l=t=>{t.style.width=t.offsetWidth+"px"};return(t,s)=>r(e).notes.length?(d(),m("div",re,[u(F,{name:"note-list",onBeforeLeave:l},{default:g(()=>[(d(!0),m(D,null,E(r(e).notes,a=>(d(),I(r(ne),x({key:a.id,ref_for:!0},a,{onDelete:i}),null,16))),128))]),_:1})])):(d(),m("div",ie,"Заметок нет"))}}),de=w(ue,[["__scopeId","data-v-a2c1afbf"]]),ce={class:"form__inputs"},_e={class:"form__bottom"},me={key:0,class:"form__error text-small"},pe=y({__name:"note-add",emits:["close"],setup(o,{emit:e}){const i=e,l=N(),t=h(""),s=h(""),a=h(""),n=(_="")=>{t.value=_,setTimeout(()=>{t.value=""},5e3)},c=async()=>{try{const _=await l.add({title:s.value,content:a.value});if(s.value="",a.value="",_.status)return i("close");n(_.message)}catch(_){console.error(_)}};return(_,v)=>(d(),I(r(z),{onSubmit:P(c,["prevent"]),class:"add-note form",loading:r(l).loading},{default:g(()=>[v[2]||(v[2]=p("h2",{class:"title-h2"},"Добавление заметки",-1)),p("div",ce,[u(r(q),{modelValue:s.value,"onUpdate:modelValue":v[0]||(v[0]=V=>s.value=V),limit:100,name:"title",label:"Название заметки",placeholder:"Введите название"},null,8,["modelValue"]),u(r(Z),{modelValue:a.value,"onUpdate:modelValue":v[1]||(v[1]=V=>a.value=V),limit:500,name:"title",label:"Текст заметки",placeholder:"Введите текст"},null,8,["modelValue"])]),p("div",_e,[u(r(k),{label:"Добавить",type:"submit",class:"form__submit"}),u(M,{name:"form-error"},{default:g(()=>[t.value?(d(),m("div",me,f(t.value),1)):b("",!0)]),_:1})])]),_:1},8,["loading"]))}}),fe=y({__name:"note-page",setup(o){const e=h(!1),i=N();return i.fetch(),(l,t)=>(d(),m("div",{class:j([{"note-page_loading":r(i).loading},"note-page"])},[u(r(de)),u(r(G),{loading:r(i).loading},null,8,["loading"]),u(r(k),{icon:"plus",onClick:t[0]||(t[0]=s=>e.value=!0),rounded:"",class:"note-page__add"}),u(r(R),{modelValue:e.value,"onUpdate:modelValue":t[2]||(t[2]=s=>e.value=s)},{default:g(()=>[u(r(pe),{onClose:t[1]||(t[1]=s=>e.value=!1)})]),_:1},8,["modelValue"])],2))}}),ye=w(fe,[["__scopeId","data-v-45829ed2"]]);export{ye as default};
