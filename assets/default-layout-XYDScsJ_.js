import{d as y,f as J,s as f,z as D,o as d,q as E,j as p,a as i,e as m,T as M,_ as T,r as U,c as x,A as I,B as K,g as G,C as Q,F as W,D as A,E as X,t as F,u as e,x as R,G as Z,H as P,b as j}from"./index-DDjnyTJG.js";import{V as O}from"./v-icon-BrRGhcQu.js";import{a as H,V as Y,b as z,d as ee}from"./v-form-CyRFnmWp.js";const oe="eye",te="eye-close",se=y({__name:"v-password",props:{model:{},modelModifiers:{}},emits:["update:model"],setup(u){const s=J(u,"model"),t=f(!1),l=D(()=>t.value?"text":"password");return(o,a)=>(d(),E(H,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=c=>s.value=c),type:l.value,placeholder:"Введите пароль"},{right:p(()=>[i("span",{onClick:a[0]||(a[0]=c=>t.value=!t.value)},[m(M,{name:"icon",mode:"out-in"},{default:p(()=>[t.value?(d(),E(O,{key:0,name:te,class:"input-label__icon"})):(d(),E(O,{key:1,name:oe,class:"input-label__icon"}))]),_:1})])]),default:p(()=>[a[2]||(a[2]=i("input",{type:"password"},null,-1))]),_:1},8,["modelValue","type"]))}}),N=T(se,[["__scopeId","data-v-83ce333e"]]),ae=y({__name:"v-popover",props:{closeClickContent:{type:Boolean}},setup(u){const s=u,t=U(!1),l=U(null),o=U(null),a=D(()=>{if(!l.value||!o.value)return{};const{top:r,left:V,width:g}=l.value.getBoundingClientRect(),w=o.value.offsetWidth;return{top:`${r+window.scrollY+70}px`,left:`${V+g-w+window.scrollX}px`}}),c=()=>{t.value=!t.value},n=r=>{const V=Object.is(r.relatedTarget,l.value),g=!r.relatedTarget;(s.closeClickContent||g||V)&&(t.value=!1)};return(r,V)=>(d(),x(W,null,[i("div",{ref_key:"trigger",ref:l,onClick:c,onBlur:n,class:"popover-trigger",tabindex:"-1"},[I(r.$slots,"trigger",{},void 0,!0)],544),(d(),E(Q,{to:"body"},[m(M,{name:"popover"},{default:p(()=>[t.value?(d(),x("div",{key:0,ref_key:"popover",ref:o,style:K(a.value),onBlur:n,class:"popover",tabindex:"-1"},[I(r.$slots,"content",{},void 0,!0)],36)):G("",!0)]),_:3})]))],64))}}),le=T(ae,[["__scopeId","data-v-973e9ea7"]]),ne={class:"user-info"},re={class:"user-info__name text-small"},ue=y({__name:"user-info",setup(u){const s=A(),t=X(),l=()=>{s.logout().then(()=>{t.push({name:"home"})})};return(o,a)=>(d(),E(e(le),{closeClickContent:!0},{trigger:p(()=>[i("div",ne,[i("span",re,F(e(s).email),1),m(e(O),{name:"user",class:"user-info__icon"})])]),content:p(()=>[i("a",{class:"exit",href:"#",onClick:R(l,["prevent"])},"Выйти")]),_:1}))}}),ie=T(ue,[["__scopeId","data-v-cb6791af"]]),de={class:"nav-bar container"},me={class:"nav-bar__right"},ce=y({__name:"nav-bar",setup(u){return(s,t)=>{const l=Z("router-link");return d(),x("div",de,[m(l,{to:"/",class:"nav-bar__home-link"},{default:p(()=>[m(e(O),{name:"logo",class:"nav-bar__logo"})]),_:1}),i("div",me,[I(s.$slots,"right",{},void 0,!0)])])}}}),_e=T(ce,[["__scopeId","data-v-7e34c1bf"]]),pe="Поле не может быть пустым",ve="Некорректная почта",fe=/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu,L=()=>{const u=f(""),s=f("");return{email:u,validateEmail:()=>{if(!u.value.length)return s.value=pe,!1;const o=fe.test(u.value);return s.value=o?"":ve,o},errorEmail:s}},q=(u=0,s=1/0)=>{const t=`Поле не может быть больше ${s} символов`,l=`Поле не может быть меньше ${u} символов`,o="Поле не может быть пустым",a=f(""),c=f("");return{password:a,validatePassword:()=>{const r=a.value.length;return r===0?(c.value=o,!1):r<u?(c.value=l,!1):r>s?(c.value=t,!1):(c.value="",!0)},errorPassword:c}},ge="Поле не может быть пустым",Ee="Пароли не совпадают",we=u=>{const s=f(""),t=f("");return{confirmPassword:s,validateConfirmPassword:()=>{const o=s.value.length,a=!!o&&u.value===s.value;return t.value=a?"":o?Ee:ge,a},errorConfirmPassword:t}},Ce={class:"form__inputs"},Ve={class:"form__bottom"},ye={class:"form__bottom-text text-small"},be={key:0,class:"form__error text-small"},$e=y({__name:"login-form",emits:["to-sign-up","next-page"],setup(u,{emit:s}){const t=A(),l=s,{email:o,validateEmail:a,errorEmail:c}=L(),{password:n,validatePassword:r,errorPassword:V}=q(4,12),g=f(!1),w=f(""),B=()=>a()&&r(),S=(C="")=>{w.value=C,setTimeout(()=>{w.value=""},5e3)},$=async()=>{if(B()){g.value=!0;try{const C=await t.login(o.value,n.value);if(C.status)return l("next-page");S(C.message)}catch(C){console.error(C)}finally{g.value=!1}}};return(C,v)=>(d(),E(e(z),{onSubmit:R($,["prevent"]),loading:g.value,class:"login-form form"},{default:p(()=>[v[4]||(v[4]=i("h2",{class:"title-h2"},"Вход в ваш аккаунт",-1)),i("div",Ce,[m(e(H),{modelValue:e(o),"onUpdate:modelValue":v[0]||(v[0]=h=>P(o)?o.value=h:null),onChange:e(a),error:e(c),name:"email",label:"Email",placeholder:"Введите email",type:"email"},null,8,["modelValue","onChange","error"]),m(e(N),{modelValue:e(n),"onUpdate:modelValue":v[1]||(v[1]=h=>P(n)?n.value=h:null),onChange:e(r),error:e(V),name:"password",label:"Пароль",placeholder:"Введите пароль"},null,8,["modelValue","onChange","error"])]),i("div",Ve,[i("span",ye,[v[3]||(v[3]=j("У вас нет аккаунта? ")),i("a",{href:"#",onClick:v[2]||(v[2]=R(h=>l("to-sign-up"),["prevent"]))},"Зарегистрируйтесь")]),m(e(Y),{label:"Войти",type:"submit",class:"form__submit"}),m(M,{name:"form-error"},{default:p(()=>[w.value?(d(),x("div",be,F(w.value),1)):G("",!0)]),_:1})])]),_:1},8,["loading"]))}}),he={class:"form__inputs"},ke={class:"form__bottom"},xe={class:"form__bottom-text text-small"},Se={key:0,class:"form__error text-small"},Pe=y({__name:"sign-up-form",emits:["to-login","next-page"],setup(u,{emit:s}){const t=A(),l=s,{email:o,validateEmail:a,errorEmail:c}=L(),{password:n,validatePassword:r,errorPassword:V}=q(4,12),{confirmPassword:g,validateConfirmPassword:w,errorConfirmPassword:B}=we(n),S=f(!1),$=f(""),C=()=>a()&&r()&&w(),v=(b="")=>{$.value=b,setTimeout(()=>{$.value=""},5e3)},h=async()=>{if(C()){S.value=!0;try{const b=await t.signUp(o.value,n.value,g.value);if(b.status){const _=await t.login(o.value,n.value);if(_.status)return l("next-page");v(_.message)}v(b.message)}catch(b){console.error(b)}finally{S.value=!1}}};return(b,_)=>(d(),E(e(z),{onSubmit:R(h,["prevent"]),loading:S.value,class:"login-form form"},{default:p(()=>[_[5]||(_[5]=i("h2",{class:"title-h2"},"Регистрация",-1)),i("div",he,[m(e(H),{modelValue:e(o),"onUpdate:modelValue":_[0]||(_[0]=k=>P(o)?o.value=k:null),onChange:e(a),error:e(c),name:"email",label:"Email",placeholder:"Введите email",type:"email"},null,8,["modelValue","onChange","error"]),m(e(N),{modelValue:e(n),"onUpdate:modelValue":_[1]||(_[1]=k=>P(n)?n.value=k:null),onChange:e(r),error:e(V),name:"password",label:"Пароль",placeholder:"Введите пароль"},null,8,["modelValue","onChange","error"]),m(e(N),{modelValue:e(g),"onUpdate:modelValue":_[2]||(_[2]=k=>P(g)?g.value=k:null),onChange:e(w),error:e(B),name:"confirm_password",label:"Пароль ещё раз",placeholder:"Введите пароль ещё раз"},null,8,["modelValue","onChange","error"])]),i("div",ke,[i("span",xe,[_[4]||(_[4]=j("У вас есть аккаунт? ")),i("a",{href:"#",onClick:_[3]||(_[3]=R(k=>l("to-login"),["prevent"]))},"Войдите")]),m(e(Y),{label:"Зарегестрироваться",type:"submit",class:"form__submit"}),m(M,{name:"form-error"},{default:p(()=>[$.value?(d(),x("div",Se,F($.value),1)):G("",!0)]),_:1})])]),_:1},8,["loading"]))}}),Re=y({__name:"entry-form",emits:["close"],setup(u,{emit:s}){const t=s,l=X(),o=f(!0),a=()=>{t("close"),l.push({name:"note"})};return(c,n)=>(d(),E(M,{name:"form",mode:"out-in"},{default:p(()=>[o.value?(d(),E(e($e),{key:0,onToSignUp:n[0]||(n[0]=r=>o.value=!1),onNextPage:a})):(d(),E(e(Pe),{key:1,onToLogin:n[1]||(n[1]=r=>o.value=!0),onNextPage:a}))]),_:1}))}}),Me=T(Re,[["__scopeId","data-v-08c2353f"]]),Te={class:"container"},Be=y({__name:"default-layout",setup(u){const s=A(),t=f(!1);return(l,o)=>(d(),x(W,null,[m(e(_e),null,{right:p(()=>[e(s).isAuth?(d(),E(e(ie),{key:0})):(d(),E(e(Y),{key:1,label:"Войти",icon:"login",onClick:o[0]||(o[0]=a=>t.value=!0)}))]),_:1}),i("main",Te,[I(l.$slots,"default")]),m(e(ee),{modelValue:t.value,"onUpdate:modelValue":o[2]||(o[2]=a=>t.value=a)},{default:p(()=>[m(e(Me),{onClose:o[1]||(o[1]=a=>t.value=!1)})]),_:1},8,["modelValue"])],64))}});export{Be as default};
